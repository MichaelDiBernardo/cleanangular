<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Promises | Clean Angular</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="alextucker">
        <meta name="description" content="As with any Framework, there are many ways to get things done. Often though choices we make in the design of
our applications leave them difficult to maintain, test and extend. This book should serve as some design choices
to consider when creating an Angular application.">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        
        <link rel="prev" href="../services/README.html" />
        

        <meta property="og:title" content="Promises | Clean Angular">
        <meta property="og:site_name" content="Clean Angular">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/alextucker">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        
        <link rel="stylesheet" href="../gitbook/style.css">
        
        
    <div class="book" data-github="alextucker/cleanangular" data-level="2.1" data-basepath=".." data-revision="1398163149242">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/alextucker/cleanangular" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    
    <a href="https://github.com/alextucker/cleanangular/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/alextucker/cleanangular/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1><a href="../" >Clean Angular</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/alextucker" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/alextucker/cleanangular/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/alextucker/cleanangular/edit/master/services/promises.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        
        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="controllers/README.html">
                
                <a href="../controllers/README.html">
                    <i class="fa fa-check"></i> <b>1.</b> Controllers
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="controllers/layout.html">
                            
                            <a href="../controllers/layout.html">
                                <i class="fa fa-check"></i> <b>1.1.</b> Controller Layout
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" data-path="controllers/as.html">
                            
                            <a href="../controllers/as.html">
                                <i class="fa fa-check"></i> <b>1.2.</b> Controller As
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3" data-path="controllers/sharing.html">
                            
                            <a href="../controllers/sharing.html">
                                <i class="fa fa-check"></i> <b>1.3.</b> Information Sharing
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2" data-path="services/README.html">
                
                <a href="../services/README.html">
                    <i class="fa fa-check"></i> <b>2.</b> Services
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="services/promises.html">
                            
                            <a href="../services/promises.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> Promises
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 100%;min-width: 83.33333333333333%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../controllers/README.html" title="Controllers" class="chapter done new-chapter" data-progress="1" style="left: 16.666666666666668%;"></a>
    
        <a href="../controllers/layout.html" title="Controller Layout" class="chapter done " data-progress="1.1" style="left: 33.333333333333336%;"></a>
    
        <a href="../controllers/as.html" title="Controller As" class="chapter done " data-progress="1.2" style="left: 50%;"></a>
    
        <a href="../controllers/sharing.html" title="Information Sharing" class="chapter done " data-progress="1.3" style="left: 66.66666666666667%;"></a>
    
        <a href="../services/README.html" title="Services" class="chapter done new-chapter" data-progress="2" style="left: 83.33333333333333%;"></a>
    
        <a href="../services/promises.html" title="Promises" class="chapter done " data-progress="2.1" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_7">
                    
                        <h2 id="promise-returning-service-pattern">Promise Returning Service Pattern</h2>
<p>Promises are a powerful way of expressing asyc operations. Many Services in Angular that you will write will be hiding async 
actions; using the network calls to the API or even WebWorkers.</p>
<pre><code class="lang-javascript">angular.module(<span class="hljs-string">'myapp.services.usersettings'</span>, [])
.factory(<span class="hljs-string">'UserSettingsService'</span>, [<span class="hljs-string">'$q'</span>, <span class="hljs-string">'$http'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($q, $http)</span>{</span>
    <span class="hljs-keyword">return</span> {
        getSettings: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> {</span>
            <span class="hljs-keyword">var</span> defer = $q.defer(); <span class="hljs-comment">// A defer object that you control</span>

            $http.get(<span class="hljs-string">'some/url'</span>)
            .success(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(resp)</span>{</span>
                defer.resolve(data);
            })
            .error(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
                defer.reject(data);
            });

            <span class="hljs-keyword">return</span> defer.promise; <span class="hljs-comment">// Return the promise of the defer you control</span>
        }
    }
}]);
</code></pre>
<p>This pattern becomes very powerful at test time. Instead to mock $http, you can just control a promise</p>
<pre><code class="lang-javascript">describe(<span class="hljs-string">'MyController'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    <span class="hljs-comment">// Scope these somewhere accessible to inside beforeEach and it blocks</span>
    <span class="hljs-keyword">var</span> ctrl, scope, userSettingsDefer;

    beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
        angular.mock.module(<span class="hljs-string">'myapp.example.controllers.user'</span>);

        angular.mock.inject(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope, $controller, $q)</span>{</span>
            userSettingsDefer = $q.defer();
            scope = $rootScope.$<span class="hljs-keyword">new</span>();
            <span class="hljs-keyword">var</span> mock = {
                getSettings: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> {</span>
                    <span class="hljs-keyword">return</span> userSettingsDefer.promise;
                }
            };

            ctrl = $controller(<span class="hljs-string">'UserController'</span>, {
                $scope: scope,
                UserSettingsService: mock
            });
        });

    });

    it(<span class="hljs-string">'should get user settings'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
        <span class="hljs-comment">// This method will call a service, and when resolved</span>
        <span class="hljs-comment">// munge the data a little and attach it to the scope.</span>
        ctrl.someMethodThatRefreshesSettings();

        <span class="hljs-comment">// Resolve the promise</span>
        userSettingsDefer.resolve({someSetting: <span class="hljs-string">'1234'</span>});

        <span class="hljs-comment">// DONT FORGET THIS</span>
        <span class="hljs-comment">// You need to manually trigger the digest so the promise watchers will propogate</span>
        $rootScope.$digest();

        <span class="hljs-comment">// Now assert that the code listening the promise did what you expected.</span>
        expect(scope.settings.someSetting).to.equal(<span class="hljs-string">'abc_1234'</span>);
    });
});
</code></pre>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../services/README.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
        <script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../gitbook/app.js"></script>
        
    </body>
</html>
